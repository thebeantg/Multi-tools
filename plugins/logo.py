from pyrogram import Client, filters, idle
import pyrogram, asyncio, random, time
from pyrogram.errors import FloodWait
from helper.fsub import ForceSub 
from pyrogram.types import *
from variables import PICS, ADMIN
from plugins.utils.logo_maker import generate_logo
from helper.errors import capture_err


@Client.on_message(filters.command("logosq") & filters.incoming & filters.text & ~filters.forwarded & filters.private)
async def logosq(bot, message):
    FSub = await ForceSub(bot, message)
    if FSub == 400:
        return 
    try:
      text = message.text.replace("logosq","").replace("/","").replace("[Hell]","").strip().upper()
      
      if text == "":
        return await message.reply_text("**To Make Logo -** /logo Your Name\n**To Make Square Logo - ** /logosq Your Name\n\n**â™»ï¸ Example:**\n/logo Hell\n/logosq Heaven")
  
      x = await message.reply_text("`ğŸ” Generating Logo For You...`")  
      logo = await generate_logo(text,True)
  
      if "graph.org" not in logo:
        return await x.edit("`âŒ Something Went Wrong...`\n\nReport This Error In [SUPPORT GRP](https://t.me/hell_botz).")
        
      if "error" in logo:
        return await x.edit(f"`âŒ Something Went Wrong...`\n\nReport This Error In [SUPPORT GRP](https://t.me/hell_botz). \n\n`{logo}`")
        
      await x.edit("`ğŸ”„ Done Generated... Now Sending You`")
      
      logo_id = logo.replace("https://graph.org//file/","").replace(".jpg","").strip()
      
      await message.reply_photo(logo,caption = f"ÊŸá´É¢á´ É¢á´‡É´á´‡Ê€á´€á´›á´‡á´… Ê™Ê ğ™ˆğ™ğ™‡ğ™ğ™„ ğ™ğ™ğ˜¼ğ™‚ğ™€ ğ˜½ğ™Šğ™\nRequested By:- [{event.sender.first_name}](tg://user?id={event.sender.id})\nCreated By: [ ğ™ˆğ™ğ™‡ğ™ğ™„ ğ™ğ™ğ˜¼ğ™‚ğ™€ ğ˜½ğ™Šğ™ ](https://t.me/Tgraph_Rbot)",reply_markup=InlineKeyboardMarkup([[InlineKeyboardButton(text="Upload As File ğŸ“", callback_data=f"flogo {logo_id}")]]))
      await x.delete()
    except FloodWait:
      pass
    except Exception as e:
      try:
        await x.delete()
      except:
        pass
      return await message.reply_text("`âŒ Something Went Wrong...`\n\nReport This Error In [Hell]")

@Client.on_message(filters.command("logo") & filters.incoming & filters.text & ~filters.forwarded & filters.private)
async def logo(bot, message):
  FSub = await ForceSub(bot, message)
  if FSub == 400:
      return 
  try:
    text = message.text.replace("logo","").replace("/","").replace("@TechZLogoMakerBot","").strip().upper()
    
    if text == "":
      return await message.reply_text("**To Make Logo -** /logo Your Name\n**To Make Square Logo - ** /logosq Your Name\n\n**â™»ï¸ Example:**\n/logo Hell\n/logosq Heaven")

    x = await message.reply_text("`ğŸ” Generating Logo For You...`")  
    logo = await generate_logo(text)

    if "graph.org" not in logo:
      return await x.edit("`âŒ Something Went Wrong...`\n\nReport This Error In  [SUPPORT GRP](https://t.me/hell_botz).")
      
    if "error" in logo:
      return await x.edit(f"`âŒ Something Went Wrong...`\n\nReport This Error In [SUPPORT GRP](https://t.me/hell_botz).\n\n`{logo}`")
      
    await x.edit("`ğŸ”„ Done Generated... Now Sending You`")

    logo_id = logo.replace("https://graph.org//file/","").replace(".jpg","").strip()
    await message.reply_photo(logo,caption = "**ğŸ–¼ Logo Generated By [MULTI TOOLS BOT](http://t.me/MULTI_TOOLS_RBOT)**",reply_markup=InlineKeyboardMarkup([[InlineKeyboardButton(text="Upload As File ğŸ“", callback_data=f"flogo {logo_id}")]]))
    await x.delete()
  except FloodWait:
    pass
  except Exception as e:
    try:
      await x.delete()
    except:
      pass
    return await message.reply_text("`âŒ Something Went Wrong...`\n\nReport This Error In [Hell]")


@Client.on_callback_query(filters.regex("flogo"))
async def logo_doc(_,query):
  await query.answer()
  try:
    x = await query.message.reply_text("`ğŸ”„ Sending You The Logo As File`")
    await query.message.edit_reply_markup(reply_markup=None)
    link = "https://graph.org//file/" + query.data.replace("flogo","").strip() + ".jpg"
    await query.message.reply_document(link,caption="**ğŸ–¼ Logo Generated By [Hell]**")
  except FloodWait:
    pass
  except Exception as e:
    try:
      return await x.edit(f"`âŒ Something Went Wrong...`\n\nReport This Error In [Hell] \n\n`{str(e)}`")
    except:
      return
    
  return await x.delete()
